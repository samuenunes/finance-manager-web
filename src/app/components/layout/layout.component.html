<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 flex">
  <!-- Sidebar -->
  <div 
    class="fixed inset-y-0 left-0 z-50 bg-white/95 dark:bg-gray-800/95 backdrop-blur-xl shadow-2xl border-r border-gray-200/50 dark:border-gray-700/50 transform transition-all duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0"
    [class.w-64]="isSidebarExpanded"
    [class.w-16]="!isSidebarExpanded"
    [class.translate-x-0]="isSidebarOpen"
    [class.-translate-x-full]="!isSidebarOpen && !isDesktop">
    
    <!-- Logo -->
    <div class="flex items-center h-16 px-4 border-b border-gray-200/50 dark:border-gray-700/50 bg-gradient-to-r from-primary-600 to-primary-700"
         [class.justify-center]="!isSidebarExpanded"
         [class.justify-between]="isSidebarExpanded">
      <div class="flex items-center">
        <app-lucide-icon name="dollar-sign" class="text-white" [size]="28"></app-lucide-icon>
        <span *ngIf="isSidebarExpanded" class="text-xl font-bold text-white ml-3">Finance Manager</span>
      </div>
      <button 
        *ngIf="isDesktop"
        type="button"
        class="p-1.5 rounded-lg text-white/80 hover:text-white hover:bg-white/10 transition-all duration-200"
        (click)="toggleSidebarExpansion()">
        <app-lucide-icon [name]="isSidebarExpanded ? 'panel-left' : 'panel-right'" [size]="20"></app-lucide-icon>
      </button>
    </div>

    <!-- Navigation -->
    <nav class="mt-6 px-3">
      <ul class="space-y-1">
        <li *ngFor="let item of menuItems">
          <a 
            [routerLink]="item.route"
            class="sidebar-item group"
            [class.active]="item.active"
            [class.justify-center]="!isSidebarExpanded"
            [title]="!isSidebarExpanded ? item.label : ''">
            <app-lucide-icon [name]="item.icon" class="transition-colors duration-200" [size]="20"
                           [class.mr-3]="isSidebarExpanded"></app-lucide-icon>
            <span *ngIf="isSidebarExpanded" class="font-medium">{{ item.label }}</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Overlay for mobile -->
  <div 
    *ngIf="isSidebarOpen && !isDesktop" 
    class="fixed inset-0 z-40 bg-black/50 backdrop-blur-sm lg:hidden"
    (click)="toggleSidebar()">
  </div>

  <!-- Main Content -->
  <div class="flex-1 flex flex-col lg:ml-0">
    <!-- Top Bar -->
    <header class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl shadow-lg border-b border-gray-200/50 dark:border-gray-700/50 sticky top-0 z-30">
      <div class="flex items-center justify-between h-16 px-4 sm:px-6 lg:px-8">
        <!-- Mobile menu button -->
        <button 
          type="button"
          class="lg:hidden p-2 rounded-xl text-gray-500 hover:text-gray-700 hover:bg-gray-100/80 dark:hover:bg-gray-700/80 transition-all duration-200"
          (click)="toggleSidebar()">
          <app-lucide-icon name="menu" [size]="24"></app-lucide-icon>
        </button>

        <!-- Page title -->
        <div class="flex-1 lg:flex lg:items-center lg:justify-between">
          <h1 class="text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent ml-4 lg:ml-0">
            {{ getPageTitle() }}
          </h1>
        </div>

        <!-- Right side -->
        <div class="flex items-center space-x-2">
          <!-- Theme toggle -->
          <button 
            type="button"
            class="p-2.5 rounded-xl text-gray-500 hover:text-primary-600 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-all duration-200 group"
            (click)="toggleTheme()">
            <app-lucide-icon [name]="isDarkMode ? 'sun' : 'moon'" [size]="20" 
                           class="group-hover:scale-110 transition-transform duration-200"></app-lucide-icon>
          </button>

          <!-- User menu -->
          <div class="relative">
            <button 
              type="button"
              class="flex items-center p-2 rounded-xl text-gray-500 hover:text-gray-700 hover:bg-gray-100/80 dark:hover:bg-gray-700/80 transition-all duration-200 group"
              (click)="toggleUserMenu()">
              <div class="w-8 h-8 bg-gradient-to-r from-primary-500 to-primary-600 rounded-lg flex items-center justify-center mr-2">
                <app-lucide-icon name="user" [size]="16" class="text-white"></app-lucide-icon>
              </div>
              <span class="text-sm font-semibold text-gray-700 dark:text-gray-300 group-hover:text-gray-900 dark:group-hover:text-white transition-colors duration-200">
                {{ currentUser?.name }}
              </span>
              <app-lucide-icon name="chevron-down" [size]="16" class="ml-2 text-gray-400 group-hover:text-gray-600 transition-colors duration-200"></app-lucide-icon>
            </button>

            <!-- Dropdown menu -->
            <div 
              *ngIf="isUserMenuOpen"
              class="absolute right-0 mt-3 w-56 bg-white/95 dark:bg-gray-800/95 backdrop-blur-xl rounded-2xl shadow-2xl py-2 z-50 border border-gray-200/50 dark:border-gray-700/50 animate-in slide-in-from-top-2 duration-200">
              <div class="px-4 py-3 border-b border-gray-200/50 dark:border-gray-700/50">
                <div class="font-semibold text-gray-900 dark:text-white">{{ currentUser?.name }}</div>
                <div class="text-sm text-gray-500 dark:text-gray-400">{{ currentUser?.email }}</div>
              </div>
              
              <button 
                type="button"
                class="w-full flex items-center px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100/80 dark:hover:bg-gray-700/80 transition-all duration-200 group"
                (click)="openSettings()">
                <app-lucide-icon name="settings" [size]="16" class="mr-3 text-gray-400 group-hover:text-primary-600 transition-colors duration-200"></app-lucide-icon>
                <span class="font-medium">Configurações</span>
              </button>
              
              <button 
                type="button"
                class="w-full flex items-center px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-600 dark:hover:text-red-400 transition-all duration-200 group"
                (click)="logout()">
                <app-lucide-icon name="log-out" [size]="16" class="mr-3 text-gray-400 group-hover:text-red-500 transition-colors duration-200"></app-lucide-icon>
                <span class="font-medium">Sair</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Page Content -->
    <main class="flex-1 overflow-y-auto">
      <div class="p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto">
        <router-outlet></router-outlet>
      </div>
    </main>
  </div>
</div>

<!-- Click outside to close user menu -->
<div 
  *ngIf="isUserMenuOpen" 
  class="fixed inset-0 z-30"
  (click)="isUserMenuOpen = false">
</div>
